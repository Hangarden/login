<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/basic">
<th:block layout:fragment="title">
  <title>리스트 페이지</title>
</th:block>

<th:block layout:fragment="search">
  <div id="adv-search" class="input-group">
    <input type="search" id="mainKeyword" class="form-control" onkeyup="document.getElementById('keyword').value = this.value;" placeholder="키워드를 입력해 주세요." />
    <div class="input-group-btn">
      <div class="btn-group" role="group">
        <div class="dropdown dropdown-lg">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-expanded="false"><span class="caret"></span></button>
          <div class="dropdown-menu dropdown-menu-right" role="menu">
            <!--/* 검색 form   드롭다운 메뉴  */-->
            <form id="searchForm" class="form-horizontal" onsubmit="return false;" autocomplete="off">
              <div class="form-group">
                <label for="searchType">검색 유형</label>
                <select id="searchType" name="searchType" class="form-control">
                  <option value="">전체</option>
                  <option value="title">제목</option>
                  <option value="content">내용</option>
                  <option value="writer">작성자</option>
                </select>
              </div>
              <div class="form-group">
                <label for="keyword">키워드</label>
                <input type="search" id="keyword" name="keyword" class="form-control" onkeyup="document.getElementById('mainKeyword').value = this.value;" placeholder="키워드를 입력해 주세요." />
              </div>
              <button type="button" onclick="movePage(1);" class="btn btn-primary"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
<!--              검색했을 때 페이지 번호가 1이 나오도록-->
            </form>
          </div>
        </div>
        <button type="button" onclick="movePage(1);" class="btn btn-primary"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>
      </div>
    </div>
  </div>
</th:block>

<th:block layout:fragment="content">
  <div class="table-responsive clearfix">
    <table class="table table-hover">
      <thead>
      <tr>
        <th>번호</th>
        <th>제목</th>
        <th>작성자</th>
        <th>등록일</th>
        <th>조회 수</th>
      </tr>
      </thead>
      <tbody id="list">

      </tbody>
    </table>

    <div class="btn_wrap text-right">
      <a th:href="@{/posts/write.do}" class="btn btn-primary waves-effect waves-light">등록</a>
    </div>

    <th:block layout:fragment="paging">
      <nav aria-label="Page navigation" class="text-center">
        <ul class="pagination">

        </ul>
      </nav>
    </th:block>
  </div>
</th:block>

<th:block layout:fragment="script">
  <script th:inline="javascript">
    /*<![CDATA[*/

    window.onload = () => {
      setQueryStringParams();

      findAllPost();
    }


    // 쿼리 스트링 파라미터 셋팅
    function setQueryStringParams() {

      if ( !location.search ) {
        return false;
      }

      const form = document.getElementById('searchForm');

      new URLSearchParams(location.search).forEach((value, key) => {
        if (form[key]) {
          form[key].value = value;
        }
      })

      document.getElementById('mainKeyword').value = form.keyword.value;
    }


    // 게시글 리스트 조회
    function findAllPost() {

      const list = [[ ${response.list} ]]; //List<T> 타입의 리스트 의미
      if ( !list.length ) {
        document.getElementById('list').innerHTML = '<tr><td colspan="5">검색된 결과가 없습니다.</td></tr>'; //리스트가 비어있을 경우 검색결과 없다 표시
        drawPage();
        return false;
      }

      const pagination = [[ ${response.pagination} ]]; //PagingResponse의 멤버인 pagination을 의미
      const params = [[ ${params} ]]; //ModelAttribute 에서 전달한 SearchDto타입의 객체인 params의미
      let num = pagination.totalRecordCount - ((params.page - 1) * params.recordSize); //게시글 번호 처리 로직,

      drawList(list, num);
      drawPage(pagination, params);
    }


    // 리스트 HTML draw
    function drawList(list, num) { //findAll에서 전달받, 게시글을 뿌리는 역할
      let html = '';
      list.forEach(obj => {
        html += `
                        <tr>
                            <td>${num--}</td>
                            <td class="text-left"><a href="javascript: void(0);" onclick="goViewPage(${obj.id});"> ${obj.title} </a></td>
                            <td>${obj.writer}</td>
                            <td>${obj.createdDate}</td>
                            <td>${obj.viewCnt}</td>
                        </tr>
                    `;
      })

      document.getElementById('list').innerHTML = html;
    }


    // 페이지 HTML draw
    function drawPage(pagination, params) { //하단 페이지에 번호를 그리는 역할

      if ( !pagination || !params ) {
        document.querySelector('.pagination').innerHTML = '';
        return false;
      }

      let html = '';

      // 첫 페이지, 이전 페이지
      if (pagination.existPrevPage) {
        html += `
                        <li><a href="javascript:void(0)" onclick="movePage(1);" aria-label="Previous"><span aria-hidden="true">&laquo;</span></a></li>
                        <li><a href="javascript:void(0)" onclick="movePage(${pagination.startPage - 1});" aria-label="Previous"><span aria-hidden="true">&lsaquo;</span></a></li>
                    `;
      }

      // 페이지 번호
      for (let i = pagination.startPage; i <= pagination.endPage; i++) {
        const active = (i === params.page) ? 'class="active"' : '';
        html += `<li ${active}><a href="javascript:void(0)" onclick="movePage(${i})">${i}</a></li>`;
      }

      // 다음 페이지, 마지막 페이지
      if (pagination.existNextPage) {
        html += `
                        <li><a href="javascript:void(0)" onclick="movePage(${pagination.endPage + 1});" aria-label="Next"><span aria-hidden="true">&rsaquo;</span></a></li>
                        <li><a href="javascript:void(0)" onclick="movePage(${pagination.totalPageCount});" aria-label="Next"><span aria-hidden="true">&raquo;</span></a></li>
                    `;
      }

      document.querySelector('.pagination').innerHTML = html;
    }


    // 페이지 이동
    function movePage(page) {

      const form = document.getElementById('searchForm');
      const queryParams = {
        page: (page) ? page : 1,
        recordSize: 10,
        pageSize: 10,
        keyword: form.keyword.value, //keyword 를 파라미터로 전달 받을 수 있도록
        searchType: form.searchType.value //searchType 을 파라미터로 전달 받을 수 있도록
      }

      location.href = location.pathname + '?' + new URLSearchParams(queryParams).toString();  //list.do?page=1&recordSize=10&keyword=n&searchparameter=writer
    }


    // 게시글 상세 페이지로 이동
    function goViewPage(id) {
      const queryString = (location.search) ? location.search + `&id=${id}` : `?id=${id}`;
      location.href = '/post/view.do' + queryString;
    }

    /*]]>*/
  </script>
</th:block>
</html>

<!--<!DOCTYPE html>-->
<!--<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/basic">-->
<!--<th:block layout:fragment="title">-->
<!--  <title>리스트 페이지</title>-->
<!--</th:block>-->

<!--<th:block layout:fragment="content">-->
<!--  <div class="page_tits">-->
<!--    <h3>게시판 관리</h3>-->
<!--    <p class="path"><strong>현재 위치 :</strong> <span>게시판 관리</span> <span>리스트형</span> <span>리스트</span></p>-->
<!--  </div>-->

<!--  <div class="content">-->
<!--    <section>-->
<!--      &lt;!&ndash;/* 검색 */&ndash;&gt;-->
<!--      <div class="search_box">-->
<!--        <form id="searchForm" onsubmit="return false;" autocomplete="off">-->
<!--          <div class="sch_group fl">-->
<!--            <select title="검색 유형 선택">-->
<!--              <option value="">전체 검색</option>-->
<!--              <option value="">제목</option>-->
<!--              <option value="">내용</option>-->
<!--            </select>-->
<!--            <input type="text" placeholder="키워드를 입력해 주세요." title="키워드 입력" />-->
<!--            <button type="button" class="bt_search"><i class="fas fa-search"></i><span class="skip_info">검색</span></button>-->
<!--          </div>-->
<!--        </form>-->
<!--      </div>-->

<!--      &lt;!&ndash;/* 리스트 */&ndash;&gt;-->
<!--      <table class="tb tb_col">-->
<!--        <colgroup>-->
<!--          <col style="width:50px;" /><col style="width:7.5%;" /><col style="width:auto;" /><col style="width:10%;" /><col style="width:15%;" /><col style="width:7.5%;" />-->
<!--        </colgroup>-->
<!--        <thead>-->
<!--        <tr>-->
<!--          <th scope="col"><input type="checkbox" /></th>-->
<!--          <th scope="col">번호</th>-->
<!--          <th scope="col">제목</th>-->
<!--          <th scope="col">작성자</th>-->
<!--          <th scope="col">등록일</th>-->
<!--          <th scope="col">조회</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        &lt;!&ndash;/* 리스트 데이터 렌더링 영역 */&ndash;&gt;-->
<!--        <tbody id="list">-->

<!--        </tbody>-->
<!--      </table>-->

<!--      &lt;!&ndash;/* 페이지네이션 렌더링 영역 */&ndash;&gt;-->
<!--      <div class="paging">-->

<!--      </div>-->

<!--      &lt;!&ndash;/* 버튼 */&ndash;&gt;-->
<!--      <p class="btn_set tr">-->
<!--        <a th:href="@{/post/write.do}" class="btns btn_st3 btn_mid">글쓰기</a>-->
<!--      </p>-->
<!--    </section>-->
<!--  </div> &lt;!&ndash;/* .content */&ndash;&gt;-->
<!--</th:block>-->

<!--<th:block layout:fragment="script">-->
<!--  <script th:inline="javascript">-->
<!--    /*<![CDATA[*/-->

<!--    window.onload = () => {-->
<!--      findAllPost();-->
<!--    }-->


<!--    // 게시글 리스트 조회-->
<!--    function findAllPost() {-->

<!--      const list = [[ ${response.list} ]];-->
<!--      if ( !list.length ) {-->
<!--        document.getElementById('list').innerHTML = '<td colspan="6"><div className="no_data_msg">검색된 결과가 없습니다.</div></td>';-->
<!--        drawPage();-->
<!--      }-->

<!--      const pagination = [[ ${response.pagination} ]];-->
<!--      const params = [[ ${params} ]];-->
<!--      let num = pagination.totalRecordCount - ((params.page - 1) * params.recordSize);-->

<!--      drawList(list, num);-->
<!--      drawPage(pagination, params);-->
<!--    }-->


<!--    // 리스트 HTML draw-->
<!--    function drawList(list, num) {-->

<!--      let html = '';-->

<!--      list.forEach(row => {-->
<!--        html += `-->
<!--            <tr>-->
<!--                <td><input type="checkbox" /></td>-->
<!--                <td>${num&#45;&#45;}</td>-->
<!--                <td class="tl"><a href="/post/view.do?id=${row.id}">${row.title}</a></td>-->
<!--                <td>${row.writer}</td>-->
<!--                <td>${dayjs(row.createdDate).format('YYYY-MM-DD HH:mm')}</td>-->
<!--                <td>${row.viewCnt}</td>-->
<!--            </tr>-->
<!--        `;-->
<!--      })-->

<!--      document.getElementById('list').innerHTML = html;-->
<!--    }-->


<!--    // 페이지 HTML draw-->
<!--    function drawPage(pagination, params) {-->

<!--      if ( !pagination || !params ) {-->
<!--        document.querySelector('.paging').innerHTML = '';-->
<!--        throw new Error('Missing required parameters...');-->
<!--      }-->

<!--      let html = '';-->

<!--      // 첫 페이지, 이전 페이지-->
<!--      if (pagination.existPrevPage) {-->
<!--        html += `-->
<!--            <a href="javascript:void(0);" onclick="movePage(1)" class="page_bt first">첫 페이지</a>-->
<!--            <a href="javascript:void(0);" onclick="movePage(${pagination.startPage - 1})" class="page_bt prev">이전 페이지</a>-->
<!--        `;-->
<!--      }-->

<!--      // 페이지 번호-->
<!--      html += '<p>';-->
<!--      for (let i = pagination.startPage; i <= pagination.endPage; i++) {-->
<!--        html += (i !== params.page)-->
<!--                ? `<a href="javascript:void(0);" onclick="movePage(${i});">${i}</a>`-->
<!--                : `<span class="on">${i}</span>`-->
<!--      }-->
<!--      html += '</p>';-->

<!--      // 다음 페이지, 마지막 페이지-->
<!--      if (pagination.existNextPage) {-->
<!--        html += `-->
<!--            <a href="javascript:void(0);" onclick="movePage(${pagination.endPage + 1});" class="page_bt next">다음 페이지</a>-->
<!--            <a href="javascript:void(0);" onclick="movePage(${pagination.totalPageCount});" class="page_bt last">마지막 페이지</a>-->
<!--        `;-->
<!--      }-->

<!--      document.querySelector('.paging').innerHTML = html;-->
<!--    }-->


<!--    // 페이지 이동-->
<!--    function movePage(page) {-->
<!--      const queryParams = {-->
<!--        page: (page) ? page : 1,-->
<!--        recordSize: 10,-->
<!--        pageSize: 10-->
<!--      }-->
<!--      location.href = location.pathname + '?' + new URLSearchParams(queryParams).toString();-->
<!--    }-->

<!--    /*]]>*/-->
<!--  </script>-->
<!--</th:block>-->
<!--</html>-->

<!--<!DOCTYPE html>-->
<!--<html lang="ko" xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="layout/basic">-->
<!--<th:block layout:fragment="title">-->
<!--  <title>리스트 페이지</title>-->
<!--</th:block>-->

<!--<th:block layout:fragment="content">-->
<!--  <div class="page_tits">-->
<!--    <h3>게시판 관리</h3>-->
<!--    <p class="path"><strong>현재 위치 :</strong> <span>게시판 관리</span> <span>리스트형</span> <span>리스트</span></p>-->
<!--  </div>-->

<!--  <div class="content">-->
<!--    <section>-->
<!--      &lt;!&ndash;/* 검색 */&ndash;&gt;-->
<!--      <div class="search_box">-->
<!--        <form id="searchForm" onsubmit="return false;" autocomplete="off">-->
<!--          <div class="sch_group fl">-->
<!--            <select title="검색 유형 선택">-->
<!--              <option value="">전체 검색</option>-->
<!--              <option value="">제목</option>-->
<!--              <option value="">내용</option>-->
<!--            </select>-->
<!--            <input type="text" placeholder="키워드를 입력해 주세요." title="키워드 입력" />-->
<!--            <button type="button" class="bt_search"><i class="fas fa-search"></i><span class="skip_info">검색</span></button>-->
<!--          </div>-->
<!--        </form>-->
<!--      </div>-->

<!--      &lt;!&ndash;/* 리스트 */&ndash;&gt;-->
<!--      <table class="tb tb_col">-->
<!--        <colgroup>-->
<!--          <col style="width:50px;" /><col style="width:7.5%;" /><col style="width:auto;" /><col style="width:10%;" /><col style="width:15%;" /><col style="width:7.5%;" />-->
<!--        </colgroup>-->
<!--        <thead>-->
<!--        <tr>-->
<!--          <th scope="col"><input type="checkbox" /></th>-->
<!--          <th scope="col">번호</th>-->
<!--          <th scope="col">제목</th>-->
<!--          <th scope="col">작성자</th>-->
<!--          <th scope="col">등록일</th>-->
<!--          <th scope="col">조회</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        <tr th:if="${not #lists.isEmpty( posts )}" th:each="row, status : ${posts}">-->
<!--          <td><input type="checkbox" /></td>-->
<!--          <td th:text="${status.size - status.index}"></td>-->
<!--          <td class="tl"><a th:href="@{/post/view.do( id=${row.id} )}" th:text="${row.title}"></a></td>-->
<!--          <td th:text="${row.writer}"></td>-->
<!--          <td th:text="${#temporals.format(row.createdDate, 'yyyy-MM-dd HH:mm' )}"></td>-->
<!--          <td th:text="${row.viewCnt}"></td>-->
<!--        </tr>-->
<!--        <tr th:unless="${not #lists.isEmpty( posts )}">-->
<!--          <td colspan="5"><div class="no_data_msg">검색된 결과가 없습니다.</div></td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--      </table>-->

<!--      &lt;!&ndash;/* 페이지네이션 */&ndash;&gt;-->
<!--      <div class="paging">-->
<!--        <a href="#" class="page_bt first">첫 페이지</a><a href="#" class="page_bt prev">이전 페이지 그룹</a>-->
<!--        <p><span class="on">1</span><a href="#">2</a><a href="#">3</a><a href="#">4</a><a href="#">5</a><a href="#">6</a><a href="#">7</a><a href="#">8</a><a href="#">9</a><a href="#">10</a></p>-->
<!--        <a href="#" class="page_bt next">다음 페이지 그룹</a><a href="#" class="page_bt last">마지막 페이지</a>-->
<!--      </div>-->

<!--      &lt;!&ndash;/* 버튼 */&ndash;&gt;-->
<!--      <p class="btn_set tr">-->
<!--        <a th:href="@{/posts/write.do}" class="btns btn_st3 btn_mid">글쓰기</a>-->
<!--      </p>-->
<!--    </section>-->
<!--  </div> &lt;!&ndash;/* .content */&ndash;&gt;-->
<!--</th:block>-->
<!--</html>-->